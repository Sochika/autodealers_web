import{d as M,r as a,o as P,c as U,b as s,a as c,w as i,n as E,F as I,H as B,L as F,i as T,K as W,C as j,j as A,p as l,t as m,h as O,g as D,f as x}from"./app.js";import K from"./PsLabelHeader3.js";import R from"./PsLabelHeader52.js";import{P as z}from"./PsCard.js";import{u as q}from"./Validators.js";import N from"./PsInput2.js";import{P as V}from"./PsInputWithRightIcon.js";import G from"./PsLabel2.js";import J from"./PsButton2.js";import{P as Q}from"./PsIcon.js";import{P as X}from"./PsCheckboxValue.js";import Y from"./PsLabelCaption3.js";import Z from"./PsLabelTitle2.js";import ee from"./PsLabelTitle32.js";import{P as oe}from"./PsLoading.js";import{f as _}from"./index.esm.js";import"./PsNotificationBox.js";import{u as re}from"./AuthStore.js";import{g as $}from"./psApiService.js";import te from"./PsFrontendLayout.js";import{U as se}from"./UserCreateParameterHolder.js";import{_ as ae}from"./plugin-vue_export-helper.js";import"./Icons.js";import"./PsLabel.js";import"./ProductStore.js";import"./ProductParameterHolder.js";import"./ps_constants.js";import"./PsApiService2.js";import"./Product.js";import"./PsObject.js";import"./DefaultPhoto.js";import"./Category.js";import"./DefaultIcon.js";import"./SubCategory.js";import"./ItemLocationTownship.js";import"./User.js";import"./RatingDetail.js";import"./ApiStatus.js";import"./PsSepetetedStore.js";import"./PsValueStore.js";import"./UserUnReadMessageParameterHolder.js";import"./auth.esm.js";import"./FooterView.js";import"./FooterLinkSection.js";import"./PsLink.js";import"./PsRouteLink.js";import"./PsIcon2.js";import"./AppInfoStore.js";import"./PsNavTabBar.js";import"./PsDropdown.js";import"./PsDropdownSelect.js";import"./PsIconToggle.js";import"./LocationModal.js";import"./PsModal2.js";import"./vue-neat-modal.js";import"./PsLine.js";import"./PsInputWithLeftIcon.js";import"./LocationParameterHolder.js";import"./ItemLocationTownshipStore.js";import"./AppInfoParameterHolder.js";import"./PsNavBar.js";import"./UserStore.js";import"./UserListParameterHolder.js";import"./PsConfirmDialog.js";import"./PsUtils.js";import"./NotificationStore.js";import"./NotiUnRegisterHolder.js";const ie=M({components:{Head:B,Link:F,PsLabelHeader3:K,PsCard:z,PsInput:N,PsInputWithRightIcon:V,PsLabel:G,PsButton:J,PsIcon:Q,PsCheckboxValue:X,PsLabelCaption:Y,PsLabelTitle:Z,PsLoading:oe,PsLabelTitle3:ee,getExistUser:$,PsLabelHeader5:R},props:{canResetPassword:Boolean,status:String,error:String,errors:Object,backendSetting:Object,userLoginData:Object,firebaseConfig:String,webPushKey:String,appUrl:String},layout:te,data(e){var o;return{form:this.$inertia.form({email:(o=e.userLoginData)==null?void 0:o.email,password:"",remember:!1,deviceToken:"",headerToken:"",loginMethod:e.userLoginData.loginMethod,google_id:e.userLoginData.google_id,facebook_id:e.userLoginData.facebook_id,apple_id:e.userLoginData.apple_id,profile_photo_url:e.userLoginData.profile_photo_url,name:e.userLoginData.name,registerForm:1,registerMethod:e.userLoginData.registerMethod,newUser:{username:e.userLoginData.username,password:""},user_phone:e.userLoginData.user_phone,phone_id:e.userLoginData.phone_id}),errors:{email:"",password:""}}},setup(e){const o=new se,d=T(),b=T(),H=T(!0),k=W(),w=j(()=>k.getters.isDarkMode),y=re(),h=JSON.parse(e.firebaseConfig);_.apps.length<1&&_.initializeApp(h);const p=_.messaging.isSupported()?_.messaging():null;p&&Notification.requestPermission().then(t=>{console.log(t==="granted"?"Notification permission granted.":"Unable to get permission to notify.")});function u(t,r){p&&fetch("https://iid.googleapis.com/iid/v1/"+t+"/rel/topics/"+r,{method:"POST",headers:new Headers({Authorization:"key="+e.backendSetting.fcm_api_key})}).then(n=>{if(n.status<200||n.status>=400)throw"Error subscribing to topic: "+n.status+" - "+n.text();console.log('Subscribed to "'+r+'"')}).catch(n=>{console.error(n)})}A(async()=>{if(k.dispatch("loadIsDarkMode"),"serviceWorker"in navigator){if(p){let t=e.appUrl,r=t+"/firebase-messaging-sw.js";t.endsWith("/")&&(r=t+"firebase-messaging-sw.js"),navigator.serviceWorker.register(r).then(function(n){p.getToken({vapidKey:e.webPushKey,serviceWorkerRegistration:n}).then(f=>{f&&(console.log("current token for client: ",f),localStorage.deviceToken=f,u(f,"fe_broadcast"))}).catch(f=>{console.log("An error occurred while retrieving token. ",f),localStorage.deviceToken="errorToken"})}).catch(function(n){localStorage.deviceToken="errorToken",console.log("Service worker registration failed, error:",n)})}}else localStorage.deviceToken="errorToken",console.log("no serviceWorker in navigator")});const{isEmpty:g,minLength:S,isEmail:v}=q();return{validateEmptyInput:(t,r)=>{e.errors[t]=r?S(t,r,4):g(t,r),t=="password"&&(b.value.isError=e.errors.password!="")},validateEmailInput:(t,r)=>{e.errors[t]=r?v(t,r):g(t,r),t=="email"&&(d.value.isError=e.errors.email!="")},email:d,password:b,isHide:H,authStore:y,paramHolder:o,isDarkMode:w}},methods:{async submit(){this.form.deviceToken=localStorage.deviceToken;const e=new Date;localStorage.headerToken=localStorage.deviceToken+e.getTime(),this.form.headerToken=localStorage.headerToken,this.form.password=this.form.newUser.password,this.paramHolder.username=this.form.newUser.username,this.paramHolder.password=this.form.newUser.password,this.paramHolder.google_id=this.form.google_id,this.paramHolder.facebook_id=this.form.facebook_id,this.paramHolder.apple_id=this.form.apple_id,this.paramHolder.email=this.form.email,this.paramHolder.name=this.form.name?this.form.name:this.form.username,this.paramHolder.profile_photo_url=this.form.profile_photo_url?this.form.profile_photo_url:"",this.paramHolder.registerForm=this.form.registerForm,this.paramHolder.loginMethod=this.form.loginMethod,this.paramHolder.user_phone=this.form.user_phone,this.paramHolder.phone_id=this.form.phone_id;const o=await this.authStore.createUserwithUsername(this.paramHolder);o.data.status=="error"&&(this.errors.email="",this.errors.password="",this.errors.email=o.data.message.username[0],this.errors.password=o.data.message.password[0]),o.data.status=="success"&&(this.form.loginMethod=="phone"&&(this.form.email=this.form.user_phone.replace("-","")),this.form.loginMethod="normal",this.form.transform(d=>({...d,remember:this.form.remember?"on":""})).post(this.route("login"),{onFinish:()=>this.form.reset("password")}))},async getCategoriesData(e){category_loadmore_visible.value=!0,is_loading.value=!0,$(e).then(o=>{this.form.newUser=o.data})},async googleloginclicked(){const e=await this.authStore.loginWithGoogleId();this.form.deviceToken=localStorage.deviceToken;const o=new Date;localStorage.headerToken=localStorage.deviceToken+o.getTime(),this.form.headerToken=localStorage.headerToken,this.form.email=e.email,this.form.password="admin123",this.form.loginMethod="google",this.form.google_id=e.uid,this.form.name=e.displayName,this.form.profile_photo_url=e.photoURL,this.form.transform(d=>({...d})).post(this.route("createUser"),{onFinish:()=>this.form.reset("password")})},handleReset(){this.$inertia.get(route("password.request"))}}}),ne={class:"min-h-screen flex flex-col lg:mt-36 mt-28 items-center pt-6 sm:pt-0 dark_bg-feAchromatic-900 dark_text-feSecondary-50"},le={class:"px-6"},me={key:0,class:"mb-4"},de={class:"mb-4"},pe={class:"mb-8"},ce={class:"block mt-4"};function fe(e,o,d,b,H,k){const w=a("Head"),y=a("ps-label-header-5"),h=a("ps-label"),p=a("ps-input"),u=a("ps-label-caption"),g=a("ps-label-title-3"),S=a("ps-icon"),v=a("ps-input-with-right-icon"),L=a("ps-loading"),C=a("ps-button"),t=a("ps-card");return P(),U(I,null,[s(w,{title:e.$t("core__fe_sign_in")},null,8,["title"]),c("div",{class:E(e.isDarkMode?"dark":"")},[c("div",ne,[s(t,{class:"w-full sm:max-w-md mt-6 py-4 dark_bg-feSecondary-800"},{default:i(()=>[c("div",le,[s(y,{class:"pt-2 text-center font-semibold"},{default:i(()=>[l(m(e.$t("core_fe_create_account")),1)]),_:1}),c("form",{class:"mt-6",onSubmit:o[6]||(o[6]=O((...r)=>e.submit&&e.submit(...r),["prevent"]))},[e.userLoginData.loginMethod=="phone"?(P(),U("div",me,[s(h,{class:"mb-2",textColor:"text-feSecondary-800 dark_text-feSecondary-200"},{default:i(()=>[l(m(e.$t("core__fe_user_phone")),1)]),_:1}),s(p,{ref:"phone",type:"text",value:e.form.user_phone,"onUpdate:value":o[0]||(o[0]=r=>e.form.user_phone=r),class:"placeholder-feSecondary-800 dark_placeholder-feSecondary-500",theme:"text-feSecondary-500 dark_bg-feSecondary-800",defaultBorder:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus_ring-1 focus_ring-fePrimary-500",placeholder:e.$t("core__fe_phone_placeholder"),disabled:!0},null,8,["value","placeholder"]),s(u,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:i(()=>[l(m(e.errors.phone),1)]),_:1})])):D("",!0),c("div",de,[s(h,{class:"mb-2",textColor:"text-feSecondary-800 dark_text-feSecondary-200"},{default:i(()=>[l(m(e.$t("core__fe_username")),1)]),_:1}),s(p,{ref:"email",type:"text",value:e.form.newUser.username,"onUpdate:value":o[1]||(o[1]=r=>e.form.newUser.username=r),class:"placeholder-feSecondary-800 dark_placeholder-feSecondary-500",theme:"text-feSecondary-500 dark_bg-feSecondary-800",defaultBorder:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus_ring-1 focus_ring-fePrimary-500",placeholder:e.$t("core__fe_username_placeholder"),autofocus:""},null,8,["value","placeholder"]),s(g,{class:"mt-2",textColor:"text-feSecondary-400 dark_text-feSecondary-500"},{default:i(()=>[l(m(e.$t("username__fe_valid_description")),1)]),_:1}),s(u,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:i(()=>[l(m(e.errors.email),1)]),_:1})]),c("div",pe,[s(h,{class:"mb-2",textColor:"text-feSecondary-800 dark_text-feSecondary-200"},{default:i(()=>[l(m(e.$t("core__fe_password")),1)]),_:1}),s(v,{value:e.form.newUser.password,"onUpdate:value":o[3]||(o[3]=r=>e.form.newUser.password=r),ref:"password",placeholderColor:"placeholder-feSecondary-400 dark_placeholder-feSecondary-500",theme:"bg-feAchromatic-50 dark_bg-feSecondary-800",type:e.isHide?"password":"text",onKeyup:o[4]||(o[4]=r=>e.validateEmptyInput("password",e.form.password)),onBlur:o[5]||(o[5]=r=>e.validateEmptyInput("password",e.form.password)),placeholder:e.$t("core__fe_password_placeholder2"),autocomplete:"current-password"},{icon:i(()=>[s(S,{onClick:o[2]||(o[2]=r=>e.isHide=!e.isHide),class:"cursor-pointer",name:e.isHide?"eyeOff":"eye-on"},null,8,["name"])]),_:1},8,["value","type","placeholder"]),s(u,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:i(()=>[l(m(e.errors.password),1)]),_:1})]),c("div",ce,[s(C,{class:"w-full mb-2"},{default:i(()=>[e.form.processing?(P(),x(L,{key:0,theme:"border-2 border-t-2 border-text-8 border-t-fePrimary-500 me-1",loadingSize:"h-5 w-5"})):D("",!0),l(" "+m(e.$t("core__fe_btn_done")),1)]),_:1})])],32),l(" "+m(e.authStore.errorMessage),1)])]),_:1})])],2)],64)}var Co=ae(ie,[["render",fe]]);export{Co as default};
