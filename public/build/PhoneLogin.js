import{d as ne,r as h,o as g,c as S,b as r,a as d,w as s,h as se,f as V,g as E,ay as ie,n as W,F as J,H as le,L as de,K as pe,C as Z,i as c,R as ce,j as me,p as i,t as l,q as ue,O as $,J as G}from"./app.js";import{f as D}from"./index.esm.js";import"./auth.esm.js";import{g as fe,P as _e,a as he}from"./PsLayout.js";import ge from"./PsLabel2.js";import"./PsLabelHeader3.js";import ve from"./PsLabelTitle2.js";import ye from"./PsLabelCaption3.js";import be from"./PsButton2.js";import{P as ke}from"./PsInput.js";import{P as we}from"./PsCard.js";import Ce from"./UserPhoneLoginVerificationModal.js";import Pe from"./PsFrontendLayout.js";import{W as Se}from"./WelcomeImage.js";import{u as $e}from"./AppInfoStore.js";import{A as Ne}from"./AppInfoParameterHolder.js";import Le from"./PsErrorDialog2.js";import{u as xe}from"./AuthStore.js";import{P as Ae}from"./PhoneLoginParameterHolder.js";import{_ as Ve}from"./plugin-vue_export-helper.js";import"./PsIcon.js";import"./Icons.js";import"./PsLabel.js";import"./PsToggle.js";import"./toggle.js";import"./PsButton.js";import"./PsModal.js";import"./vue-neat-modal.js";import"./PsSuccessDialog.js";import"./PsInputWithRightIcon.js";import"./PsLoading.js";import"./PsLabelCaption.js";import"./PsBannerIcon.js";import"./PsIcon1.js";import"./PsLoadingCircleDialog.js";import"./PsModal2.js";import"./PsLine.js";import"./PsInput2.js";import"./FooterView.js";import"./FooterLinkSection.js";import"./PsLink.js";import"./PsRouteLink.js";import"./PsIcon2.js";import"./ProductParameterHolder.js";import"./ps_constants.js";import"./PsValueStore.js";import"./PsApiService2.js";import"./PsObject.js";import"./DefaultPhoto.js";import"./PsNavTabBar.js";import"./PsDropdown.js";import"./PsDropdownSelect.js";import"./PsIconToggle.js";import"./LocationModal.js";import"./PsInputWithLeftIcon.js";import"./LocationParameterHolder.js";import"./ItemLocationTownship.js";import"./PsSepetetedStore.js";import"./ItemLocationTownshipStore.js";import"./PsNavBar.js";import"./UserStore.js";import"./User.js";import"./RatingDetail.js";import"./UserListParameterHolder.js";import"./ApiStatus.js";import"./UserUnReadMessageParameterHolder.js";import"./PsConfirmDialog.js";import"./PsUtils.js";import"./PsNotificationBox.js";import"./ProductStore.js";import"./Product.js";import"./Category.js";import"./DefaultIcon.js";import"./SubCategory.js";import"./NotificationStore.js";import"./NotiUnRegisterHolder.js";const Ie=ne({name:"PhoneLoginView",components:{Head:le,Link:de,PsLabel:ge,PsLabelTitle:ve,PsButton:be,PsInput:ke,UserPhoneLoginVerificationModal:Ce,PsErrorDialog:Le,PsLabelCaption:ye,PsCard:we,PsDangerDialog:fe,WelcomeImage:Se,PsDropdown:_e,PsDropdownSelect:he},props:{backendSetting:Object,status:String,error:String,errors:Object,phoneCodes:Object,firebaseConfig:String},layout:Pe,setup(e){var O,T,q,R;const t=xe(),b=new Ae,j=pe(),H=Z(()=>j.getters.isDarkMode),z=Z(()=>j.getters.dir),N=c(),L=c(),v=c(),w=c(),x=c(),p=$e();let o=ce({email:"",password:"",remember:!1,deviceToken:"",headerToken:"",loginMethod:"",google_id:"",profile_photo_url:"",name:"",displayName:"",registerMethod:"",user_phone:"",username:"",phone_id:"",phone_code:(R=(q=(T=(O=p==null?void 0:p.appInfo)==null?void 0:O.data)==null?void 0:T.defaultPhoneCountryCode)==null?void 0:q.id)!=null?R:"1",phone_string:""});const U=JSON.parse(e.firebaseConfig);D.apps.length<1&&D.initializeApp(U);const u=c(),k=c(),C=c(),I=c(),n=c(!1),M=c(!1),B=c(),K=c(),Q=c(!1);let A,m,F;t.loading.value=!1;function X(){t.loading.value=!0,setTimeout(()=>{window.recaptchaVerifier=new D.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible",callback:a=>{console.log("Callback"),console.log(a)},"expired-callback":()=>{console.log("expiry callback")}}),F=window.recaptchaVerifier,t.loading.value=!1},1e3)}me(async()=>{var y,f,_,P;X();const a=new Ne;a.userId="nologinuser",await p.loadAppInfo(a),o.phone_code=(P=(_=(f=(y=p==null?void 0:p.appInfo)==null?void 0:y.data)==null?void 0:f.defaultPhoneCountryCode)==null?void 0:_.id)!=null?P:"1"});function Y(){$.Inertia.get(route("login"))}async function ee(){w.value="",A!=null&&await A.confirm(I.value).then(async a=>{if(a!=null&&a.user!=null&&a.user.uid!=null&&a.user.uid!=""){const y=a.user;b.phoneId=y.uid,t.loading.value=!0,m.data.message.user_isexisted=="2"&&(o.loginMethod="phone",o.username=u.value,o.user_phone=k.value,o.phone_id=y.uid,$.Inertia.post(route("CreateLogin"),o,{})),m.data.message.user_isexisted=="1"&&(o.loginMethod="phone",o.username=u.value,o.email="admin@gmail.com",o.user_phone=k.value,o.password="admin@123",o.phone_id=y.uid,o.name=u.value,$.Inertia.post(route("login"),o,{}))}else t.setLoading(!1)}).catch(a=>{t.setLoading(!1),w.value=a==null?void 0:a.message})}async function oe(){let a=e.phoneCodes.filter(f=>f.id==o.phone_code)[0].country_code;k.value=a+o.phone_string,C.value=a+"-"+o.phone_string,b.userName=u.value,b.userPhone=C.value,b.displayName=o.displayName,t.loading.value=!0;const y=F;m=await t.existUser(b),m.data.status=="error"&&(N.value="",L.value="",v.value="",N.value=m.data.message.username?m.data.message.username[0]:"",L.value=m.data.message.user_phone?m.data.message.user_phone[0]:"",v.value=m.data.message.displayName?m.data.message.displayName[0]:"",t.loading.value=!1),m.data.status=="success"&&(A=await D.auth().signInWithPhoneNumber(k.value,y).catch(f=>{t.loading.value=!1,w.value=f==null?void 0:f.message}),A!=null&&B.value.openModal(G("phone_no_verification_modal__title"),"","Submit","Cancel",async f=>{t.loading.value=!0,await A.confirm(f).then(async _=>{if(_!=null&&_.user!=null&&_.user.uid!=null&&_.user.uid!=""){const P=_.user;b.phoneId=P.uid,B.value.actionClicked("no"),m.data.message.user_isexisted=="2"&&(o.loginMethod="phone",o.username=u.value,o.user_phone=C.value,o.phone_id=P.uid,$.Inertia.post(route("CreateLogin"),o,{})),m.data.message.user_isexisted=="1"&&(o.loginMethod="phone",o.username=u.value,o.email="admin@gmail.com",o.user_phone=C.value,o.password="admin@123",o.phone_id=P.uid,o.name=u.value,$.Inertia.post(route("login"),o,{}))}else t.setLoading(!1)}).catch(_=>{t.setLoading(!1),K.value.openModal(G("phone_login__error_in_sign_in"),_==null?void 0:_.message)})},()=>{console.log("Cancel")}))}function te(){$.Inertia.post(route("login"))}function ae(a){/^\/$|(\/[a-zA-Z_0-9-]+)+$/.test(a.target.value)?n.value=!0:n.value=!1}function re(a){/^\/$|(\/[a-zA-Z_0-9-]+)+$/.test(a.target.value)?M.value=!0:M.value=!1}return{authStore:t,clicked:oe,name:u,phone:k,user_phone_login_verification_modal:B,ps_error_dialog:K,loginClicked:Y,isValidUserName:n,validateName:ae,validatePhone:re,isValidPhone:M,dir:z,isDarkMode:H,test:te,usernameError:N,phoneError:L,ps_danger_dialog:x,code:I,code_data_ready:Q,codeClicked:ee,codeError:w,form:o,displayNameError:v}},watch:{async errors(e){this.errors.user_ban&&(this.authStore.loading.value=!1)}}}),Me={class:"mb-6 bg-feAchromatic-50 dark_bg-feAchromatic-900 flex flex-row mt-28 min-h-screen items-center justify-center"},Ee={class:"h-176 my-6 flex flex-row w-98 lg:w-202 rounded-md overflow-hidden shadow-md"},De={class:"hidden w-100 h-auto bg-feSecondary-900 lg:flex flex-col items-center justify-center"},je={class:"w-65 h-50"},Ue={class:"flex-grow bg-feAchromatic-50 dark_bg-feSecondary-800 px-10 pb-10"},Be={class:"px-6"},He={class:"flex"},ze={class:"rounded-md shadow-xs w-16 bg-feAchromatic-50 dark_bg-feAchromatic-900"},Ke={class:"pt-2 z-20"},Fe={key:0},Oe={key:1},Te=["onClick"],qe=d("div",{id:"recaptcha-container"},null,-1),Re=i(),We=d("br",null,null,-1),Je={class:"flex items-center justify-center mb-4 lg:mt-56"},Ze={class:"flex flex-auto justify-center mt-4 mb-10"},Ge={key:0};function Qe(e,t,b,j,H,z){const N=h("Head"),L=h("welcome-image"),v=h("ps-label"),w=h("ps-label-title"),x=h("ps-input"),p=h("ps-label-caption"),o=h("ps-dropdown-select"),U=h("ps-dropdown"),u=h("ps-button"),k=h("user-phone-login-verification-modal"),C=h("ps-error-dialog"),I=h("ps-danger-dialog");return g(),S(J,null,[r(N,{title:e.$t("core__fe_sign_in")},null,8,["title"]),d("div",{class:W(e.isDarkMode?"dark":"")},[d("div",Me,[d("div",Ee,[d("div",De,[d("div",je,[r(L)]),r(v,{class:"text-lg font-semibold mt-6 mb-2",textColor:"text-feSecondary-50"},{default:s(()=>[i(l(e.$t("login__fe_title_best_deal")),1)]),_:1}),r(v,{class:"text-base font-normal text-center mb-2 mx-10",textColor:"text-feSecondary-200"},{default:s(()=>[i(l(e.$t("login__fe_description_best_deal")),1)]),_:1})]),d("div",Ue,[d("form",{onSubmit:t[4]||(t[4]=se((...n)=>e.clicked&&e.clicked(...n),["prevent"]))},[d("div",Be,[r(w,{class:"text-center m-auto pb-8 pt-2 mt-10",textColor:"text-feSecondary-600 dark_text-feSecondary-50"},{default:s(()=>[i(l(e.$t("phone_login__phone_login")),1)]),_:1}),r(v,{class:"mt-4"},{default:s(()=>[i(l(e.$t("core__fe_phone_login__display_name"))+" : ",1)]),_:1}),r(x,{class:"mt-2 placeholder-feSecondary-800 dark_placeholder-feSecondary-500",type:"text",placeholder:e.$t("core__fe_phone_login__display_name_placeholder"),theme:"text-feSecondary-500 dark_bg-feSecondary-800",defaultBorder:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus_ring-1 focus_ring-fePrimary-500",value:e.form.displayName,"onUpdate:value":t[0]||(t[0]=n=>e.form.displayName=n)},null,8,["placeholder","value"]),e.isValidUserName?(g(),V(p,{key:0,class:"mt-2 mx-8",textColor:"text-fePrimary-500 dark_text-feAccent-500"},{default:s(()=>[i(l(e.$t("phone_login__user_name_required")),1)]),_:1})):E("",!0),r(p,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:s(()=>[i(l(e.displayName),1)]),_:1}),r(v,{class:"mt-4"},{default:s(()=>[i(l(e.$t("phone_label"))+" : ",1)]),_:1}),d("div",He,[r(U,{align:"left",class:"mt-2 w-20"},{select:s(()=>[r(o,{border:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus_ring-1 focus_ring-fePrimary-500",placeholder:"phone",showCenter:!0,selectedValue:e.form.phone_code==""?"":e.phoneCodes.filter(n=>n.id==e.form.phone_code)[0].country_code,onChange:t[1]||(t[1]=n=>[e.form.phone_code=e.phoneCode.id])},null,8,["selectedValue"])]),list:s(()=>[d("div",ze,[d("div",Ke,[e.phoneCodes.length===0?(g(),S("div",Fe,[r(v,{class:"p-2 flex cursor-pointer"},{default:s(()=>[i(l(e.$t("core_fe_empty_phone_list")),1)]),_:1})])):(g(),S("div",Oe,[(g(!0),S(J,null,ue(e.phoneCodes,n=>(g(),S("div",{key:n.id,class:"w-96 flex py-4 px-2 hover_bg-fePrimary-50 dark_hover_bg-feSecondary-700 cursor-pointer items-center",onClick:M=>[e.form.phone_code=n.id]},[r(v,{class:W(["ms-2",n.id==e.form.phone_code?" font-bold":""])},{default:s(()=>[i(l(n.country_code),1)]),_:2},1032,["class"])],8,Te))),128))]))])])]),_:1}),r(x,{class:"mt-2",onKeyup:ie(e.clicked,["enter"]),onKeypress:e.validatePhone,type:"text",theme:"text-feSecondary-500 dark_bg-feSecondary-800",defaultBorder:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus_ring-1 focus_ring-fePrimary-500",placeholder:e.$t("phone_login__fe_phone_number_placeholderv2"),value:e.form.phone_string,"onUpdate:value":t[2]||(t[2]=n=>e.form.phone_string=n)},null,8,["onKeyup","onKeypress","placeholder","value"])]),r(p,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:s(()=>[i(l(e.errors.user_ban),1)]),_:1}),e.isValidPhone?(g(),V(p,{key:1,class:"mt-2 mx-8",textColor:"text-fePrimary-500 dark_text-feAccent-500"},{default:s(()=>[i(l(e.$t("phone_login__phone_required")),1)]),_:1})):E("",!0),r(p,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:s(()=>[i(l(e.phoneError),1)]),_:1}),e.code_data_ready?(g(),V(x,{key:2,class:"mt-4",type:"text",placeholder:e.$t("phone_login__code"),value:e.code,"onUpdate:value":t[3]||(t[3]=n=>e.code=n)},null,8,["placeholder","value"])):E("",!0),r(p,{textColor:"text-feError-500 ",class:"mt-2 block"},{default:s(()=>[i(l(e.codeError),1)]),_:1}),qe,Re,We,d("div",Je,[e.authStore.loading.value?(g(),V(u,{key:0,class:"mt-6 w-full",disabled:!0},{default:s(()=>[i(l(e.$t("phone_login__loading")),1)]),_:1})):(g(),V(u,{key:1,class:"mt-6 w-full",onClick:e.clicked,disabled:!1},{default:s(()=>[i(l(e.$t("phone_login__login")),1)]),_:1},8,["onClick"]))]),d("div",Ze,[r(u,{colors:"bg-feAchromatic-50 dark_bg-feSecondary-800 dark_text-feSecondary-50 ",border:"border",class:"mt-6 w-full",onClick:e.loginClicked,disabled:!1},{default:s(()=>[i(l(e.$t("core__fe_btn_cancel")),1)]),_:1},8,["onClick"])])]),e.code_data_ready?(g(),S("div",Ge)):E("",!0)],32)])])])],2),r(k,{ref:"user_phone_login_verification_modal"},null,512),r(C,{ref:"ps_error_dialog"},null,512),r(I,{ref:"ps_danger_dialog"},null,512)],64)}var kt=Ve(Ie,[["render",Qe]]);export{kt as default};
