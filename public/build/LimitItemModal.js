import"https://checkout.razorpay.com/v1/checkout.js";import oe from"./PsModal2.js";import ne from"./PsLabel2.js";import se from"./PsButton2.js";import ie from"./PsRadio2.js";import le from"./PsRadio22.js";import re from"./PsErrorDialog2.js";import me from"./PsWarningDialog2.js";import de from"./PsIcon2.js";import pe from"./StripePaymentModal.js";import ce from"./PaypalPaymentModal.js";import ue from"./OfflinePaymentModal.js";import fe from"./InputEmailModal.js";import{u as _e}from"./AppInfoStore.js";import{P as ye}from"./PsValueStore.js";import{u as ge}from"./UserStore.js";import{u as Pe}from"./PackageStore.js";import{A as ke}from"./AppInfoParameterHolder.js";import{a as J,P as D,b as G}from"./PsApiService2.js";import{L as Q}from"./LimitAdTransaction.js";import{aC as Ie,B as V,i as f,Y as ve,a_ as he,d as Se,r as k,o as M,c as X,b as m,w as i,a as v,f as T,p as u,t as r,g as N,F as Ae,q as be,J as H}from"./app.js";import{m as Me}from"./PsSepetetedStore.js";import{P as R}from"./ps_constants.js";import{c as ee}from"./inline.js";import{P as O}from"./PsUtils.js";import{f as Ce}from"./format.min.js";import{_ as we}from"./plugin-vue_export-helper.js";class K{constructor(){this.userId="",this.packageId="",this.paymentMethod="",this.paymentMethodNounce="",this.price="",this.razorId="",this.isPaystack=""}ItemLimitParameterHolder(){this.userId="",this.packageId="",this.paymentMethod="",this.paymentMethodNounce="",this.price="",this.razorId="",this.isPaystack=""}toMap(){const a={};return a.user_id=this.userId,a.package_id=this.packageId,a.payment_method=this.paymentMethod,a.payment_method_nonce=this.paymentMethodNounce,a.price=this.price,a.razor_id=this.razorId,a.is_paystack=this.isPaystack,a}}const Le=Me(e=>Ie(`limitAdItemStore/${e}`,()=>{const a=V({value:!1}),n=V(new J),Y=V(new J),h=V({value:!1});let S=f(10),s=0,A="";function b(t){var p,y;n!=null&&n.data!=null&&n.data.length>0&&s!=0?(t.data!=null&&t.data.length>0?(((p=t.data)==null?void 0:p.length)<S.value?a.value=!0:a.value=!1,n.data.push(...t.data)):a.value=!0,n.code=t.code,n.status=t.status,n.message=t.message):(((y=t.data)==null?void 0:y.length)<S.value||t.data==null?a.value=!0:a.value=!1,n.data=t.data,n.code=t.code,n.status=t.status,n.message=t.message),n!=null&&n.data!=null&&(s=n.data.length)}async function I(t){const p=new K;p.userId=t,h.value=!0;const y=await D.getLimitAdItemList(new Q,t,S.value,s,p.toMap());b(y),h.value=!1}async function _(t){const p=new K;p.userId=t,s=0,h.value=!0;const y=await D.getLimitAdItemList(new Q,t,S.value,s,p.toMap());b(y),h.value=!1}return{isNoMoreRecord:a,buyadList:n,buyad:Y,loading:h,limit:S,offset:s,id:A,loadPaidAdItemList:I,resetPaidAdItemList:_}}));ve.add(he);const Ee=Se({name:"LimitItemModal",components:{PsModal:oe,PsIcon:de,PsLabel:ne,PsButton:se,PsErrorDialog:re,PsRadio2:le,PsRadio:ie,StripePaymentModal:pe,PaypalPaymentModal:ce,OfflinePaymentModal:ue,PsWarningDialog2:me,InputEmailModal:fe},setup(){const e=f(),a=f(),n=f(),Y=f(),h=f(),S=f(),s=f(),A=f(),b=Pe(),I=Le(),_=new K,t=_e(),p=new ke,y=ge(),C=ye().getLoginUserId(),F=f(0),l=f(""),d=f("");async function L(){e.value.toggle(!0),await I.resetPaidAdItemList(C),await b.resetPackageList(C);const o=await t.loadAppInfo(p);l.value=o.data.razorKey,o.status==G.SUCCESS?F.value=parseInt(o.data.oneDay,10):F.value=0}function E(o){t.appInfo.data.mobileSetting.is_demo_for_payment==1?s.value.openModal(H("payment__warning_title"),H("payment__confirm_message"),H("payment__ok"),H("credit_card_modal__cancel"),()=>{o=="PAYPAL"?B():o=="STRIPE"?$():o=="RAZOR"?U():o=="PAYSTACK"?Z():o=="OFFLINE"&&j()},()=>{O.log("Cancel")}):o=="PAYPAL"?B():o=="STRIPE"?$():o=="RAZOR"?U():o=="PAYSTACK"?Z():o=="OFFLINE"&&j()}function $(){e.value.toggle(!1),a.value.openModal(()=>{const o=R.PAYMENT_STRIPE_METHOD.toString();g(o)},()=>{O.log("Cancel")})}async function g(o){var P;_.userId=C,_.packageId=(P=A.value.paymentInfo)==null?void 0:P.id,_.paymentMethod=o,_.paymentMethodNounce=localStorage.paymentNonce||"",_.price=A.value.paymentAttributes.price,_.razorId=d.value||"";const c=await b.postPackageBought(C,_);e.value.toggle(!1),c.status==G.ERROR?h.value.openModal("",b.limititem.message):(localStorage.paymentNonce="",location.reload())}function B(){e.value.toggle(!1),n.value.openModal(()=>{const o=R.PAYMENT_PAYPAL_METHOD.toString();g(o)},()=>{O.log("Cancel")})}async function U(){const c=(await y.loadUser(C)).data,P={key:l.value,name:"Test Company",prefill:{email:c.userEmail,name:c.userName,contact:c.userPhone},theme:{color:"#0e9f6e"},handler:async function(z){d.value=z.razorpay_payment_id,g(R.PAYMENT_RAZOR_METHOD.toString())}},w=new window.Razorpay(P);w.open(),w.on("payment.failed",function(z){})}async function Z(){var w;const c=(await y.loadUser(C)).data;let P=c.userEmail;c.userEmail==""||c.userEmail==null?S.value.openModal(z=>{var W;P=z,ee.setup({key:(W=t==null?void 0:t.appInfo)==null?void 0:W.data.payStackKey,email:P,amount:A.value.price,callback:async function(ae){O.log(ae),g(R.PAYMENT_PAY_STACK_METHOD.toString())},onClose:function(){}}).openIframe()},()=>{console.log("cancel")}):ee.setup({key:(w=t==null?void 0:t.appInfo)==null?void 0:w.data.payStackKey,email:P,amount:A.value.paymentAttributes.price,callback:async function(q){O.log(q),g(R.PAYMENT_PAY_STACK_METHOD.toString())},onClose:function(){}}).openIframe()}function j(){e.value.toggle(!1),Y.value.openModal(()=>{const o=R.PAYMENT_OFFLINE_METHOD.toString();g(o)},()=>{O.log("Cancel")})}function te(o){var c,P,w;return o.toString()=="0"?H("item_price__free"):Ce((w=(P=(c=t==null?void 0:t.appInfo)==null?void 0:c.data)==null?void 0:P.mobileSetting)==null?void 0:w.price_format,o)}return{psmodal:e,openModal:L,packageprovider:b,appInfoStore:t,limitProvider:I,ps_error_dialog:h,stripe_payment_modal:a,paypal_payment_modal:n,offline_payment_modal:Y,selected:A,ps_warning_dialog:s,paymentClicked:E,input_email:S,formatPrice:te}}}),Te={class:"flex justify-between items-start"},$e={class:""},Ne={class:"flex flex-wrap"},Re={class:"flex flex-col mt-6 sm:mt-7"},Oe={class:""},Ye={class:"flex flex-col w-full"},ze={class:"flex flex-col w-full mt-6 gap-2 sm:gap-4",id:"r1"},He={class:"font-light"},Fe={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mt-6"};function Ve(e,a,n,Y,h,S){const s=k("ps-label"),A=k("ps-icon"),b=k("ps-radio-2"),I=k("ps-button"),_=k("ps-modal"),t=k("stripe-payment-modal"),p=k("paypal-payment-modal"),y=k("ps-warning-dialog-2"),x=k("offline-payment-modal"),C=k("ps-error-dialog"),F=k("input-email-modal");return M(),X("div",null,[m(_,{ref:"psmodal",line:"hidden",maxWidth:"534px",isClickOut:!1,class:"h-full",bodyHeight:"max-h-72",theme:"px-4 py-8 sm:p-8 rounded-lg"},{title:i(()=>{var l,d,L,E;return[v("div",Te,[v("div",$e,[((l=e.limitProvider.buyadList)==null?void 0:l.data)!=null&&((E=(L=(d=e.limitProvider.buyadList)==null?void 0:d.data[0])==null?void 0:L.user)==null?void 0:E.remainingPost)==0?(M(),T(s,{key:0,textColor:"text-lg font-semibold text-feSecondary-800 mb-2"},{default:i(()=>[u(r(e.$t("limit_item_modal__quota_running_out.")),1)]),_:1})):N("",!0),v("div",Ne,[m(s,{class:"text-lg font-semibold text-feSecondary-800 me-2"},{default:i(()=>[u(r(e.$t("limit_item_modal__limit")),1)]),_:1}),m(s,{class:"text-lg"},{default:i(()=>[u(r(e.$t("limit_item_modal__limit_post_buy")),1)]),_:1})])]),m(A,{class:"cursor-pointer dark_text-feSecondary-500",name:"close",w:"24",h:"24",onClick:a[0]||(a[0]=$=>e.psmodal.toggle(!1))})])]}),body:i(()=>[v("div",Re,[v("div",Oe,[v("div",Ye,[m(s,{class:"font-medium text-base"},{default:i(()=>[u(r(e.$t("promote_item_modal__choose_package")),1)]),_:1}),v("div",ze,[(M(!0),X(Ae,null,be(e.packageprovider.packageList.data,l=>(M(),T(b,{class:"",key:l.packageId,value:l,selectedValue:e.selected,"onUpdate:selectedValue":a[1]||(a[1]=d=>e.selected=d)},{title:i(()=>[v("div",null,[m(s,{class:"ms-2 text-sm text-feSecondary-800"},{default:i(()=>[u(r(l.paymentInfo.value)+" - "+r(l.paymentAttributes.count)+" "+r(e.$t("limit_item_modal__post")),1)]),_:2},1024)])]),price:i(()=>[m(s,{class:"font-semibold text-base"},{default:i(()=>{var d;return[v("span",He,r((d=l.paymentAttributes)==null?void 0:d.currencySymbol),1),u(" "+r(e.formatPrice(l.paymentAttributes.price)),1)]}),_:2},1024)]),_:2},1032,["value","selectedValue"]))),128))])])])])]),footer:i(()=>{var l,d,L,E,$;return[m(s,{class:"mt-6 sm:mt-7 font-medium text-base"},{default:i(()=>[u(r(e.$t("promote_item_modal__pay_with")),1)]),_:1}),v("div",Fe,[((l=e.appInfoStore.appInfo.data)==null?void 0:l.paypalEnable)=="1"?(M(),T(I,{key:0,class:"",padding:"px-8 py-4",rounded:"rounded-lg",onClick:a[2]||(a[2]=g=>e.paymentClicked("PAYPAL"))},{default:i(()=>[u(r(e.$t("promote_item_modal__pay_with_paypal")),1)]),_:1})):N("",!0),((d=e.appInfoStore.appInfo.data)==null?void 0:d.stripeEnable)=="1"?(M(),T(I,{key:1,class:"",padding:"px-8 py-4",rounded:"rounded-lg",onClick:a[3]||(a[3]=g=>e.paymentClicked("STRIPE"))},{default:i(()=>[u(r(e.$t("promote_item_modal__pay_with_stripe")),1)]),_:1})):N("",!0),((L=e.appInfoStore.appInfo.data)==null?void 0:L.razorEnable)=="1"?(M(),T(I,{key:2,class:"",padding:"px-8 py-4",rounded:"rounded-lg",onClick:a[4]||(a[4]=g=>e.paymentClicked("RAZOR"))},{default:i(()=>[u(r(e.$t("promote_item_modal__pay_with_razor")),1)]),_:1})):N("",!0),((E=e.appInfoStore.appInfo.data)==null?void 0:E.payStackEnabled)=="1"?(M(),T(I,{key:3,class:"",padding:"px-8 py-4",rounded:"rounded-lg",onClick:a[5]||(a[5]=g=>e.paymentClicked("PAYSTACK"))},{default:i(()=>[u(r(e.$t("promote_item_modal__pay_with_stack")),1)]),_:1})):N("",!0),(($=e.appInfoStore.appInfo.data)==null?void 0:$.offlineEnabled)=="1"?(M(),T(I,{key:4,class:"",padding:"px-8 py-4",rounded:"rounded-lg",onClick:a[6]||(a[6]=g=>e.paymentClicked("OFFLINE"))},{default:i(()=>[u(r(e.$t("promote_item_modal__pay_with_offline")),1)]),_:1})):N("",!0)])]}),_:1},512),m(t,{ref:"stripe_payment_modal"},null,512),m(p,{ref:"paypal_payment_modal"},null,512),m(y,{ref:"ps_warning_dialog"},null,512),m(x,{ref:"offline_payment_modal"},null,512),m(C,{ref:"ps_error_dialog"},null,512),m(F,{ref:"input_email"},null,512)])}var Ke=we(Ee,[["render",Ve]]),_t=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{Ke as L,_t as a,Le as u};
